!function(){app.factory("Table",["$http",function(a){function e(){this.list=[],this.query={page:1,pagesize:10}}return e.prototype.init=function(a){return this.error=!1,this.ready=!1,this.list=[],this.query={page:1,pagesize:10},this.link=a.link,this.callback=a.callback||function(){},a.query&&(this.query=$.extend(this.query,a.query)),this},e.prototype.getList=function(e){var s=this;e=e||s.query.page,s.query.page=e,a({url:s.link,params:s.query,method:"GET",headers:{"X-Requested-With":"XMLHttpRequest"}}).then(function(a){var e=a.data;0==e.error?(s.list=e.data.list,s.pageCount=e.data.page_count,s.num=e.data.num):(s.error=!0,s.errorMsg=e.msg),s.callback(e)}).catch(function(a){s.error=!0,s.errorMsg=a.status}).finally(function(){s.ready=!0})},new e}]),app.directive("tablePage",function(){return{restrict:"AE",template:'<div class="table-page"></div>',link:function(a,e,s,t){var n;a.$watch(s.tablePage,function(a){if(n=a,a&&a.pageCount&&a.pageCount>1){$(e).find(".table-page").html('<span class="pre">上一页</span>                        <span class="next">下一页</span>'),1==a.query.page?$(e).find(".pre").addClass("disabled"):a.query.page==a.pageCount&&$(e).find(".next").addClass("disabled");var s="";if(a.pageCount>10)if(a.query.page<6){for(var t=1;t<=a.query.page+2;t++)s+=t==a.query.page?'<span class="page-to now">'+t+"</span>":'<span class="page-to">'+t+"</span>";s+='...<span class="page-to">'+a.pageCount+"</span>"}else if(a.query.page>=6&&a.query.page<a.pageCount-2){s+='<span class="page-to">1</span>...';for(var t=a.query.page-2;t<=a.query.page+2;t++)s+=t==a.query.page?'<span class="page-to now">'+t+"</span>":'<span class="page-to">'+t+"</span>";s+='...<span class="page-to">'+a.pageCount+"</span>"}else{s+='<span class="page-to">1</span>...';for(var t=a.query.page-2;t<=a.pageCount;t++)s+=t==a.query.page?'<span class="page-to now">'+t+"</span>":'<span class="page-to">'+t+"</span>"}else for(var t=1;t<=a.pageCount;t++)s+=t==a.query.page?'<span class="page-to now">'+t+"</span>":'<span class="page-to">'+t+"</span>";$(e).find(".pre").after(s)}else $(e).find(".table-page").html("")},!0),$(e).on("click",".page-to",function(){$(this).hasClass("now")||n.getList(parseInt($(this).text()))}),$(e).on("click",".pre",function(){$(this).hasClass("disabled")||n.getList(n.query.page-1)}),$(e).on("click",".next",function(){$(this).hasClass("disabled")||n.getList(n.query.page+1)})}}})}();